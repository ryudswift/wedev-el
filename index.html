<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Tech Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- This is a lightweight Markdown-to-HTML converter -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- This is a lightweight, themeable syntax highlighter -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />

    <style>
        :root {
            --bg-color: #111827;
            --card-bg: #1f2937;
            --border-color: #374151;
            --primary-text: #f9fafb;
            --secondary-text: #9ca3af;
            --accent-color: #3b82f6;
            --modal-backdrop: rgba(0, 0, 0, 0.8);
        }
        body {
            background-color: var(--bg-color);
            color: var(--primary-text);
            font-family: 'Exo 2', sans-serif;
        }
        /* Fix for the layout issue you saw */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        .tech-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .tech-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .card-preview {
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #111827; /* Darker preview background */
        }
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--modal-backdrop);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none; /* Changed by JS */
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-container {
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-content {
            padding: 1.5rem;
            overflow-y: auto;
            font-family: 'Exo 2', sans-serif;
        }
        .modal-content h1, .modal-content h2 {
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        .modal-content h1 { font-size: 1.5rem; }
        .modal-content h2 { font-size: 1.25rem; }
        .modal-content p { color: var(--secondary-text); line-height: 1.6; }
        .modal-content code:not([class*="language-"]) {
            background-color: #374151;
            color: #e5e7eb;
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-family: 'Roboto Mono', monospace;
        }
        /* Code snippet styling */
        pre[class*="language-"] {
            position: relative;
            border-radius: 0.5rem;
            margin: 1rem 0;
            overflow: hidden;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #4b5563;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }
        pre:hover .copy-btn {
            opacity: 1;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <header class="text-center mb-12">
        <h1 class="text-4xl sm:text-5xl font-bold">Element Dashboard</h1>
        <p class="text-lg text-secondary-text mt-2">A dynamic library of UI components.</p>
    </header>

    <main>
        <!-- The grid where cards will be injected by JavaScript -->
        <div id="card-grid" class="card-grid">
             <!-- Loading state can go here -->
        </div>
    </main>

    <!-- The container where modals will be injected by JavaScript -->
    <div id="modal-container"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            // This array simulates scanning your /elements/ directory.
            // Add the filenames of your JSON files here.
            const elementFiles = [
                '[DEV]glow-pulse-text.json'
                // Add more .json filenames here as you create them
                // e.g., '[DEV]3d-card-tilt.json'
            ];
            
            const cardGrid = document.getElementById('card-grid');
            const modalContainer = document.getElementById('modal-container');

            /**
             * Fetches all element JSON files and builds the UI.
             */
            async function initializeDashboard() {
                for (const fileName of elementFiles) {
                    try {
                        const response = await fetch(`./elements/${fileName}`);
                        if (!response.ok) {
                            throw new Error(`Failed to load ${fileName}: ${response.statusText}`);
                        }
                        const data = await response.json();
                        
                        // Create and append the card to the grid
                        const cardHTML = createCardHTML(data);
                        cardGrid.insertAdjacentHTML('beforeend', cardHTML);

                        // Create and append the modal (initially hidden)
                        const modalHTML = createModalHTML(data);
                        modalContainer.insertAdjacentHTML('beforeend', modalHTML);

                    } catch (error) {
                        console.error(error);
                        cardGrid.innerHTML += `<p>Error loading ${fileName}.</p>`;
                    }
                }
                // Once all cards and modals are in the DOM, attach event listeners
                attachEventListeners();
            }

            /**
             * Creates the HTML for a single card.
             * @param {object} data - The data from a single element's JSON file.
             * @returns {string} The HTML string for the card.
             */
            function createCardHTML(data) {
                // Inline style tag for the live preview on the card
                const previewStyle = data.card_preview.css ? `<style>${data.card_preview.css}</style>` : '';
                return `
                    <div class="tech-card cursor-pointer" data-modal-id="modal-${data.id}">
                        <div class="card-preview">
                            ${previewStyle}
                            ${data.card_preview.html}
                        </div>
                        <div class="p-6 flex-grow">
                            <h3 class="text-xl font-bold">${data.card_title}</h3>
                            <p class="text-secondary-text mt-2">${data.card_description}</p>
                        </div>
                    </div>
                `;
            }

            /**
             * Creates the HTML for a single modal.
             * @param {object} data - The data from a single element's JSON file.
             * @returns {string} The HTML string for the modal.
             */
            function createModalHTML(data) {
                let contentHTML = '';
                // Loop through the flexible content blocks
                for (const block of data.modal_content) {
                    switch (block.type) {
                        case 'title':
                            contentHTML += `<h1>${block.text}</h1>`;
                            break;
                        case 'subtitle':
                            contentHTML += `<h2>${block.text}</h2>`;
                            break;
                        case 'markdown':
                            contentHTML += marked.parse(block.text); // Uses the Marked.js library
                            break;
                        case 'code_snippet':
                            contentHTML += `
                                <pre class="language-${block.language}">
                                    <button class="copy-btn">Copy</button>
                                    <code class="language-${block.language}">${Prism.highlight(block.code, Prism.languages[block.language], block.language)}</code>
                                </pre>
                            `;
                            break;
                    }
                }

                return `
                    <div id="modal-${data.id}" class="modal-overlay">
                        <div class="modal-container">
                            <div class="modal-content">
                                ${contentHTML}
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * Attaches all necessary event listeners after the UI is built.
             */
            function attachEventListeners() {
                // Open Modals
                document.querySelectorAll('.tech-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const modalId = card.dataset.modalId;
                        const modal = document.getElementById(modalId);
                        if (modal) {
                            modal.style.display = 'flex';
                            setTimeout(() => {
                                modal.style.opacity = '1';
                                modal.querySelector('.modal-container').style.transform = 'scale(1)';
                            }, 10);
                        }
                    });
                });

                // Close Modals by clicking on the overlay
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) { // Only close if the backdrop is clicked
                             modal.style.opacity = '0';
                             modal.querySelector('.modal-container').style.transform = 'scale(0.95)';
                             setTimeout(() => modal.style.display = 'none', 300);
                        }
                    });
                });
                
                // Add copy button functionality
                document.querySelectorAll('.copy-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const code = button.nextElementSibling.innerText;
                        navigator.clipboard.writeText(code).then(() => {
                            button.textContent = 'Copied!';
                            setTimeout(() => button.textContent = 'Copy', 2000);
                        });
                    });
                });
            }

            // Start the process
            initializeDashboard();
        });
    </script>
</body>
</html>
