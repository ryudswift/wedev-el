<!DOCTYPE html>
<!-- The class here will be changed by JavaScript -->
<html lang="en" class="theme-dark"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Tech Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />

    <style>
        /* --- THEME DEFINITIONS --- */
        /* 1. Default Dark Theme */
        .theme-dark {
            --bg-color: #111827;
            --card-bg: #1f2937;
            --border-color: #374151;
            --primary-text: #f9fafb;
            --secondary-text: #9ca3af;
            --accent-color: #3b82f6;
            --modal-backdrop: rgba(0, 0, 0, 0.8);
        }
        /* 2. Light Theme */
        .theme-light {
            --bg-color: #f9fafb;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --primary-text: #111827;
            --secondary-text: #4b5563;
            --accent-color: #2563eb;
            --modal-backdrop: rgba(255, 255, 255, 0.8);
        }
        /* 3. Ubuntu Theme */
        .theme-ubuntu {
            --bg-color: #2c001e;
            --card-bg: #3b142f;
            --border-color: #58334d;
            --primary-text: #f2f2f2;
            --secondary-text: #d9d9d9;
            --accent-color: #E95420;
            --modal-backdrop: rgba(0, 0, 0, 0.8);
        }

        /* --- CORE STYLES --- */
        body {
            background-color: var(--bg-color);
            color: var(--primary-text);
            font-family: 'Exo 2', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            min-height: 300px;
        }
        .tech-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            transition: all 0.2s ease-out;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .tech-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border-color: var(--accent-color);
        }
        .card-preview {
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: var(--bg-color); /* Use theme variable */
            border-bottom: 1px solid var(--border-color); /* Use theme variable */
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .sync-button {
             background-color: var(--accent-color);
             color: white;
             font-family: 'Roboto Mono', monospace;
             padding: 0.75rem 2rem;
             border-radius: 0.5rem;
             transition: all 0.3s ease;
             box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .sync-button:hover {
             transform: translateY(-3px) scale(1.05);
             box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        .sync-button:disabled {
             opacity: 0.5;
             cursor: not-allowed;
        }
        /* Theme Switcher FAB */
        #theme-switcher {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background-color: var(--card-bg);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        #theme-switcher:hover {
            transform: scale(1.1) rotate(15deg);
            border-color: var(--accent-color);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--modal-backdrop);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none; align-items: center; justify-content: center;
            z-index: 50; opacity: 0; transition: opacity 0.3s ease;
        }
        .modal-container {
            background-color: var(--card-bg); border-radius: 0.5rem; border: 1px solid var(--border-color);
            width: 90%; max-width: 800px; max-height: 90vh;
            display: flex; flex-direction: column;
            transform: scale(0.95); transition: all 0.3s ease;
        }
        .modal-content {
            padding: 1.5rem; overflow-y: auto;
            font-family: 'Exo 2', sans-serif;
        }
        .modal-content h1, .modal-content h2 {
            font-family: 'Roboto Mono', monospace; font-weight: 700;
            margin-top: 1.5em; margin-bottom: 0.5em;
        }
        .modal-content h1 { font-size: 1.5rem; color: var(--primary-text); }
        .modal-content h2 { font-size: 1.25rem; color: var(--primary-text); }
        .modal-content p { color: var(--secondary-text); line-height: 1.6; }
        .modal-content code:not([class*="language-"]) {
            background-color: var(--border-color);
            color: var(--primary-text);
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-family: 'Roboto Mono', monospace;
        }
        pre[class*="language-"] {
            position: relative; border-radius: 0.5rem; margin: 1rem 0; overflow: hidden;
        }
        .copy-btn {
            position: absolute; top: 0.5rem; right: 0.5rem;
            background-color: #4b5563; color: white; border: none;
            border-radius: 0.25rem; padding: 0.25rem 0.5rem; font-size: 0.75rem;
            cursor: pointer; opacity: 0; transition: opacity 0.2s;
        }
        pre:hover .copy-btn { opacity: 1; }
    </style>
</head>
<body class="p-4 sm:p-8">

    <header class="text-center mb-12">
        <h1 class="text-4xl sm:text-5xl font-bold">Element Dashboard</h1>
        <p class="text-lg text-secondary-text mt-2">A dynamic library of UI components.</p>
        <div class="mt-8">
            <button id="sync-button" class="sync-button font-bold text-lg">
                Sync Elements
            </button>
        </div>
    </header>

    <main>
        <div id="card-grid" class="card-grid">
             <div id="initial-prompt" class="col-span-full flex items-center justify-center text-center text-secondary-text">
                <p>Click the "Sync Elements" button to load components.</p>
            </div>
        </div>
    </main>

    <div id="modal-container"></div>
    
    <button id="theme-switcher" title="Switch Theme">ðŸŽ¨</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            const elementFiles = [
                '[DEV]glow-pulse-text.json',
                '[DEV]fab-theme-switcher.json'
            ];
            
            const cardGrid = document.getElementById('card-grid');
            const modalContainer = document.getElementById('modal-container');
            const syncButton = document.getElementById('sync-button');
            const initialPrompt = document.getElementById('initial-prompt');
            const themeSwitcher = document.getElementById('theme-switcher');

            // --- THEME SWITCHER LOGIC ---
            const themes = ['theme-dark', 'theme-light', 'theme-ubuntu'];
            let currentThemeIndex = 0;

            function applyTheme(themeClass) {
                // Simplified and more direct way to set the class
                document.documentElement.className = themeClass;
                localStorage.setItem('dashboard-theme', themeClass);
                currentThemeIndex = themes.indexOf(themeClass);
            }

            themeSwitcher.addEventListener('click', () => {
                const nextThemeIndex = (currentThemeIndex + 1) % themes.length;
                applyTheme(themes[nextThemeIndex]);
            });

            // --- MAIN DASHBOARD LOGIC ---
            async function syncAndLoadElements() {
                syncButton.disabled = true;
                syncButton.textContent = 'Syncing...';
                cardGrid.innerHTML = ''; 
                modalContainer.innerHTML = '';
                if (initialPrompt) initialPrompt.style.display = 'none';

                for (const fileName of elementFiles) {
                    try {
                        const response = await fetch(`./elements/${fileName}`);
                        if (!response.ok) throw new Error(`Failed to load ${fileName}`);
                        const data = await response.json();
                        
                        cardGrid.insertAdjacentHTML('beforeend', createCardHTML(data));
                        modalContainer.insertAdjacentHTML('beforeend', createModalHTML(data));
                    } catch (error) {
                        console.error(error);
                        cardGrid.innerHTML += `<p class="text-red-500">Error loading ${fileName}. Check console.</p>`;
                    }
                }
                
                attachEventListeners();
                
                syncButton.disabled = false;
                syncButton.textContent = 'Sync Complete';
                setTimeout(() => syncButton.textContent = 'Sync Elements', 2000);
            }
            
            function createCardHTML(data) {
                const previewStyle = data.card_preview.css ? `<style>${data.card_preview.css}</style>` : '';
                return `
                    <div class="tech-card cursor-pointer" data-modal-id="modal-${data.id}">
                        <div class="card-preview">
                            ${previewStyle}
                            ${data.card_preview.html}
                        </div>
                        <div class="p-6 flex-grow">
                            <h3 class="text-xl font-bold">${data.card_title}</h3>
                            <p class="text-secondary-text mt-2">${data.card_description}</p>
                        </div>
                    </div>
                `;
            }

            function createModalHTML(data) {
                let contentHTML = '';
                for (const block of data.modal_content) {
                    switch (block.type) {
                        case 'title':
                            contentHTML += `<h1>${block.text}</h1>`;
                            break;
                        case 'subtitle':
                            contentHTML += `<h2>${block.text}</h2>`;
                            break;
                        case 'markdown':
                            contentHTML += marked.parse(block.text);
                            break;
                        case 'code_snippet':
                            const lang = block.language || 'markup';
                            const highlightedCode = Prism.highlight(block.code, Prism.languages[lang] || Prism.languages.markup, lang);
                            contentHTML += `
                                <pre class="language-${lang}">
                                    <button class="copy-btn">Copy</button>
                                    <code class="language-${lang}">${highlightedCode}</code>
                                </pre>
                            `;
                            break;
                    }
                }
                return `
                    <div id="modal-${data.id}" class="modal-overlay">
                        <div class="modal-container">
                            <div class="modal-content">${contentHTML}</div>
                        </div>
                    </div>
                `;
            }

            function attachEventListeners() {
                document.querySelectorAll('.tech-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const modalId = card.dataset.modalId;
                        const modal = document.getElementById(modalId);
                        if (modal) {
                            modal.style.display = 'flex';
                            setTimeout(() => {
                                modal.style.opacity = '1';
                                modal.querySelector('.modal-container').style.transform = 'scale(1)';
                            }, 10);
                        }
                    });
                });

                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                             modal.style.opacity = '0';
                             modal.querySelector('.modal-container').style.transform = 'scale(0.95)';
                             setTimeout(() => modal.style.display = 'none', 300);
                        }
                    });
                });
                
                document.querySelectorAll('.copy-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const code = button.nextElementSibling.innerText;
                        navigator.clipboard.writeText(code).then(() => {
                            button.textContent = 'Copied!';
                            setTimeout(() => button.textContent = 'Copy', 2000);
                        });
                    });
                });
            }

            // Attach the main event listener to the sync button
            syncButton.addEventListener('click', syncAndLoadElements);

            // --- INITIAL PAGE LOAD ---
            // Load saved theme or default to the first one
            const savedTheme = localStorage.getItem('dashboard-theme') || themes[0];
            applyTheme(savedTheme);
        });
    </script>
</body>
</html>
